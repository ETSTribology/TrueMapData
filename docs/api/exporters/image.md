# Image Exporter

The Image Exporter module provides comprehensive functionality for converting height maps into a variety of specialized image formats for 3D graphics, material creation, and visualization purposes.

## Overview

Surface height data contains rich information that can be represented in different ways for different applications. This module provides tools to convert raw height maps into various specialized image formats that are used across different domains:

- **Game development**: Normal maps, displacement maps, roughness maps
- **3D rendering**: Material textures for PBR workflows
- **Manufacturing**: Surface analysis and visualization
- **Scientific visualization**: Data representation

## Core Map Types

### Displacement Map
Grayscale representation of height values, where brighter pixels represent higher points on the surface.

```python
convert_heightmap_to_displacement_map(height_map, filename="displacement.png", units="µm")
```

### Normal Map
RGB representation of surface normals (direction perpendicular to the surface at each point). Used to simulate detailed lighting without high polygon counts.

```python
convert_heightmap_to_normal_map(height_map, filename="normal.png", strength=1.5) 
```

### Bump Map
Grayscale representation used to fake small surface details when rendered with light.

```python
convert_heightmap_to_bump_map(height_map, filename="bump.png", strength=1.2, blur_radius=0.8)
```

### Ambient Occlusion Map
Grayscale representation of how exposed each point is to ambient lighting, adding realism to rendered surfaces.

```python
convert_heightmap_to_ao_map(height_map, filename="ao_map.png", samples=8, intensity=1.2)
```

### Multi-Channel Maps
Combined formats that store different surface properties in different channels:

```python
# RGBE format (RGB = normals, Alpha = height)
convert_heightmap_to_multi_channel_map(height_map, filename="material.png", channel_type="rgbe")

# RG format (simplified gradient representation)
convert_heightmap_to_multi_channel_map(height_map, filename="gradients.png", channel_type="rg") 
```

## Surface Analysis Maps

### Roughness Map
Quantifies local surface variations, useful for both visualization and material creation.

```python
roughness_map = generate_roughness_map(height_map, kernel_size=3, scale=1.5)
```

### ORM Map
Combined Occlusion-Roughness-Metallic map used in PBR rendering pipelines.

```python
orm_map = create_orm_map(ambient_occlusion, roughness_map, base_color_map)
```

### Edge Map 
Highlights edges and boundaries in the surface data.

```python
edge_map = generate_edge_map(displacement_map, threshold1=50, threshold2=150)
```

## Complete Material Generation

Generate a full suite of maps for rendering or material creation:

```python
maps = generate_maps_from_tmd(
    height_map,
    tmd_metadata={
        "normal_strength": 2.0,
        "bump_strength": 1.5,
        "roughness_scale": 1.2,
        "units": "µm",
        "x_length": 15.0,
        "y_length": 15.0
    },
    output_dir="output/materials"
)
```

This generates a comprehensive set of maps and saves them to the specified directory, including:
- Displacement map
- Normal map
- Bump map
- Roughness map
- Ambient occlusion map
- ORM combined map
- Edge map
- Slope map
- JSON metadata with physical dimensions and statistical properties

## Complete API Reference

::: tmd.exporters.image.convert_heightmap_to_displacement_map

::: tmd.exporters.image.convert_heightmap_to_normal_map

::: tmd.exporters.image.convert_heightmap_to_bump_map

::: tmd.exporters.image.convert_heightmap_to_multi_channel_map

::: tmd.exporters.image.convert_heightmap_to_ao_map

::: tmd.exporters.image.generate_roughness_map

::: tmd.exporters.image.generate_maps_from_tmd

::: tmd.exporters.image.generate_all_maps

## Usage in PBR Workflows

The maps generated by this module can be directly used in physically-based rendering (PBR) workflows in software like:

- Blender
- Unreal Engine
- Unity
- Substance Designer/Painter
- Photoshop/GIMP

## Examples

### Basic Map Creation

```python
from tmd.processor import TMDProcessor
from tmd.exporters.image import convert_heightmap_to_normal_map

# Process a TMD file
processor = TMDProcessor("sample.tmd")
data = processor.process()
height_map = data['height_map']

# Generate a normal map with custom strength
normal_map = convert_heightmap_to_normal_map(
    height_map,
    filename="normal_map.png",
    strength=2.0  # Exaggerated normals for stronger effect
)
```

### Map Parameter Experimentation

```python
from tmd.exporters.image import convert_heightmap_to_bump_map
import matplotlib.pyplot as plt

# Create bump maps with different parameters
strengths = [0.5, 1.0, 2.0]
blur_values = [0.0, 0.5, 1.0, 2.0]

fig, axs = plt.subplots(len(strengths), len(blur_values), figsize=(15, 10))

for i, strength in enumerate(strengths):
    for j, blur in enumerate(blur_values):
        # Generate bump map with current parameters
        bump_map = convert_heightmap_to_bump_map(
            height_map,
            filename=f"bump_s{strength}_b{blur}.png",
            strength=strength,
            blur_radius=blur
        )
        
        # Display in grid
        axs[i, j].imshow(bump_map, cmap='gray')
        axs[i, j].set_title(f"Str={strength}, Blur={blur}")
        axs[i, j].axis('off')

plt.tight_layout()
plt.savefig("bump_map_comparison.png", dpi=300)
```
